<%@ page language="abap" %>                                                                                                                                                                                                                                    
<%@ extension name="htmlb" prefix="htmlb" %>                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
<htmlb:content design="DESIGN2008">                                                                                                                                                                                                                            
  <htmlb:page title="Orders">                                                                                                                                                                                                                                  
    <htmlb:form>                                                                                                                                                                                                                                               
      <%@ include file="style_embed.htm" %>                                                                                                                                                                                                                    
      <table width="100%" cellpadding="0" cellspacing="0">                                                                                                                                                                                                     
        <tr>                                                                                                                                                                                                                                                   
          <!-- NAV BAR -->                                                                                                                                                                                                                                     
          <td valign="top" width="220px">                                                                                                                                                                                                                      
            <%@ include file="sidebar.htm" %>                                                                                                                                                                                                                  
          </td>                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
          <!-- Main Content -->                                                                                                                                                                                                                                
          <td valign="top" style="padding:20px">                                                                                                                                                                                                               
              <div class="orders">                                                                                                                                                                                                                             
                <htmlb:textView text="Here are your orders:" design="EMPHASIZED" />                                                                                                                                                                            
                <!-- e.g. a tableView of orders -->                                                                                                                                                                                                            
                <htmlb:tableView                                                                                                                                                                                                                               
                id               = "transactionTable"                                                                                                                                                                                                          
                headerText       = "Filtered Transactions"                                                                                                                                                                                                     
                table            = "<%= lt_filtered %>"                                                                                                                                                                                                        
                width            = "100%"                                                                                                                                                                                                                      
                footerVisible    = "false"                                                                                                                                                                                                                     
                selectionMode    = "NONE"                                                                                                                                                                                                                      
                columnHeaderVisible = "true"                                                                                                                                                                                                                   
                emptyTableText   = "No transactions found.">                                                                                                                                                                                                   
                  <htmlb:tableViewColumn columnName="BILLING_DOC" title="Billing Doc" />                                                                                                                                                                       
                  <htmlb:tableViewColumn columnName="CURRENCY" title="Currency" />                                                                                                                                                                             
                  <htmlb:tableViewColumn columnName="AMOUNT" title="Amount" />                                                                                                                                                                                 
                  <htmlb:tableViewColumn columnName="STATE" title="Status" />                                                                                                                                                                                  
                  <htmlb:tableViewColumn                                                                                                                                                                                                                       
                      columnName   = "taler_state"                                                                                                                                                                                                             
                      title        = "TALER STATE"                                                                                                                                                                                                             
                  />                                                                                                                                                                                                                                           
                  <htmlb:tableViewColumn                                                                                                                                                                                                                       
                      columnName   = "taler_pay_uri"                                                                                                                                                                                                           
                      title        = "ORDER TALER URI"                                                                                                                                                                                                         
                  />                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
              </htmlb:tableView>                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          <!-- Overlay -->                                                                                                                                                                                                                                     
          <div id="urlPopupOverlay"                                                                                                                                                                                                                            
               style="display:none;                                                                                                                                                                                                                            
                      position:fixed;top:0;left:0;width:100%;height:100%;                                                                                                                                                                                      
                      background:rgba(0,0,0,0.5);z-index:999;"                                                                                                                                                                                                 
               onclick="closePopup()"></div>                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          <!-- Popup -->                                                                                                                                                                                                                                       
          <div id="urlPopup"                                                                                                                                                                                                                                   
               style="display:none;                                                                                                                                                                                                                            
                      position:fixed;top:50%;left:50%;                                                                                                                                                                                                         
                      transform:translate(-50%,-50%);                                                                                                                                                                                                          
                      background:#fff;padding:1rem;                                                                                                                                                                                                            
                      border:1px solid #ccc;box-shadow:0 2px 10px rgba(0,0,0,0.2);                                                                                                                                                                             
                      z-index:1000;">                                                                                                                                                                                                                          
            <div style="display: flex; justify-content: space-between; align-items: start;">                                                                                                                                                                   
              <h3 style="margin-top: 0;">Taler Order Status Page</h3>                                                                                                                                                                                          
              <span onclick="closePopup()"                                                                                                                                                                                                                     
                 style="cursor:pointer;font-size:1.5rem;font-weight:bold; line-height:1;">&times;</span>                                                                                                                                                       
            </div>                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            <iframe                                                                                                                                                                                                                                            
              id="urlPopupFrame"                                                                                                                                                                                                                               
              style="width:80vw; height:80vh; border:1px solid #ccc;"                                                                                                                                                                                          
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups">                                                                                                                                                                              
            </iframe>                                                                                                                                                                                                                                          
          </div>                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          <script>                                                                                                                                                                                                                                             
            // once the tableView has rendered...                                                                                                                                                                                                              
            document.addEventListener('DOMContentLoaded', function(){                                                                                                                                                                                          
              var regex = /\/orders\/.*\?token=/;                                                                                                                                                                                                              
              document.querySelectorAll('span.urTxtStd').forEach(function(span){                                                                                                                                                                               
                var url = span.textContent.trim();                                                                                                                                                                                                             
                if (regex.test(url)) {                                                                                                                                                                                                                         
                  // create the button                                                                                                                                                                                                                         
                  var btn = document.createElement('button');                                                                                                                                                                                                  
                  btn.type = 'button';                                                                                                                                                                                                                         
                  btn.textContent = 'Show URL';                                                                                                                                                                                                                
                  btn.style.cursor = 'pointer';                                                                                                                                                                                                                
                  btn.addEventListener('click', function(e){                                                                                                                                                                                                   
                    e.preventDefault();                                                                                                                                                                                                                        
                    e.stopPropagation();                                                                                                                                                                                                                       
                    openPopup(url);                                                                                                                                                                                                                            
                  });                                                                                                                                                                                                                                          
                  // swap it in                                                                                                                                                                                                                                
                  span.parentNode.replaceChild(btn, span);                                                                                                                                                                                                     
                }                                                                                                                                                                                                                                              
              });                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            function openPopup(url) {                                                                                                                                                                                                                          
              // point the iframe at the URL                                                                                                                                                                                                                   
              const frame = document.getElementById('urlPopupFrame');                                                                                                                                                                                          
              frame.src = url;                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
              // show overlay + popup                                                                                                                                                                                                                          
              document.getElementById('urlPopup').style.display = 'block';                                                                                                                                                                                     
              document.getElementById('urlPopupOverlay').style.display = 'block';                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            function closePopup() {                                                                                                                                                                                                                            
              document.getElementById('urlPopup').style.display = 'none';                                                                                                                                                                                      
              document.getElementById('urlPopupOverlay').style.display = 'none';                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
          </script>                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          <%--                                                                                                                                                                                                                                                 
          <htmlb:group id="popupGroup">                                                                                                                                                                                                                        
            <htmlb:groupHeader>                                                                                                                                                                                                                                
              <htmlb:textView text="QR Code Info" />                                                                                                                                                                                                           
            </htmlb:groupHeader>                                                                                                                                                                                                                               
            <htmlb:groupBody>                                                                                                                                                                                                                                  
              <htmlb:textView text="Here is your saved HTML content for QR Code!" />                                                                                                                                                                           
              <!-- Add more fields/views here as needed -->                                                                                                                                                                                                    
            </htmlb:groupBody>                                                                                                                                                                                                                                 
          </htmlb:group>                                                                                                                                                                                                                                       
          --%>                                                                                                                                                                                                                                                 
            </div>                                                                                                                                                                                                                                             
          </td>                                                                                                                                                                                                                                                
        </tr>                                                                                                                                                                                                                                                  
      </table>                                                                                                                                                                                                                                                 
    </htmlb:form>                                                                                                                                                                                                                                              
  </htmlb:page>                                                                                                                                                                                                                                                
</htmlb:content>                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               